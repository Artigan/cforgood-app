<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: User
  
    &mdash; Documentation by YARD 0.9.9
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "User";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (U)</a> &raquo;
    
    
    <span class="title">User</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: User
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationRecord.html" title="ApplicationRecord (class)">ApplicationRecord</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationRecord.html" title="ApplicationRecord (class)">ApplicationRecord</a></span></li>
          
            <li class="next">User</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/user.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<h2 id="label-Schema+Information">Schema Information</h2>

<p>Table name: users</p>

<pre class="code ruby"><code class="ruby">id                     :integer          not null, primary key
email                  :string           default(&quot;&quot;), not null
encrypted_password     :string           default(&quot;&quot;), not null
reset_password_token   :string
reset_password_sent_at :datetime
remember_created_at    :datetime
sign_in_count          :integer          default(0), not null
current_sign_in_at     :datetime
last_sign_in_at        :datetime
current_sign_in_ip     :inet
last_sign_in_ip        :inet
created_at             :datetime         not null
updated_at             :datetime         not null
first_name             :string
last_name              :string
provider               :string
uid                    :string
name                   :string
token                  :string
token_expiry           :datetime
admin                  :boolean          default(FALSE), not null
birthday               :datetime
nationality            :string
country_of_residence   :string
mangopay_id            :string
mangopay_card_id       :string
cause_id               :integer
member                 :boolean          default(FALSE), not null
subscription           :string
trial_done             :boolean          default(FALSE), not null
date_subscription      :datetime
date_last_payment      :datetime
active                 :boolean          default(TRUE), not null
street                 :string
zipcode                :string
city                   :string
latitude               :float
longitude              :float
date_end_partner       :date
code_partner           :string
date_support           :date
amount                 :integer
date_stop_subscription :datetime
picture                :string
ambassador             :boolean          default(FALSE)
onesignal_id           :string
ecosystem_id           :integer
supervisor             :boolean          default(FALSE)
supervisor_id          :integer
phone                  :string
logo                   :string
authentication_token   :string(30)
business_supervisor_id :integer
nothing_around         :integer
customer_id            :string
card_id                :string
shared_customer_id     :string
plan_id                :string
subscription_id        :string
forced_geoloc          :boolean          default(FALSE), not null
last_ecosystem_seen    :string
sponsorship_done       :boolean          default(FALSE), not null</code></pre>

<p>Indexes</p>

<pre class="code ruby"><code class="ruby">index_users_on_authentication_token    (authentication_token) UNIQUE
index_users_on_business_supervisor_id  (business_supervisor_id)
index_users_on_cause_id                (cause_id)
index_users_on_email                   (email) UNIQUE
index_users_on_reset_password_token    (reset_password_token) UNIQUE
index_users_on_supervisor_id           (supervisor_id)</code></pre>

<p>Foreign Keys</p>

<pre class="code ruby"><code class="ruby">fk_rails_130d5504e9  (cause_id =&gt; causes.id)
fk_rails_3972f91257  (supervisor_id =&gt; users.id)
fk_rails_a4d8477c38  (business_supervisor_id =&gt; businesses.id)</code></pre>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_for_facebook_oauth-class_method" title="find_for_facebook_oauth (class method)">.<strong>find_for_facebook_oauth</strong>(access_token, signed_in_resourse = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_for_google_oauth2-class_method" title="find_for_google_oauth2 (class method)">.<strong>find_for_google_oauth2</strong>(access_token, signed_in_resourse = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_uri-class_method" title="process_uri (class method)">.<strong>process_uri</strong>(uri)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collection_supervising-instance_method" title="#collection_supervising (instance method)">#<strong>collection_supervising</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_event_last_ecosystem_seen-instance_method" title="#create_event_last_ecosystem_seen (instance method)">#<strong>create_event_last_ecosystem_seen</strong>(ecosystem_now)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_event_no_business-instance_method" title="#create_event_no_business (instance method)">#<strong>create_event_no_business</strong>(lat_lng)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_name_or_email-instance_method" title="#find_name_or_email (instance method)">#<strong>find_name_or_email</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>def should_payin?   ( !self.code_partner.present? &amp;&amp; ( (
self.subscription == “M” &amp;&amp; ( !self.date_last_payment.present? || (
self.date_last_payment &lt; Time.now - 1.month ) ) ) ||   (
self.subscription == “Y” &amp;&amp; ( !self.date_last_payment.present? || (
self.date_last_payment &lt; Time.now - 12.month ) ) ) ) ||   (
self.code_partner.present? &amp;&amp; self.date_end_partner &lt; Time.now )
) end.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#member!-instance_method" title="#member! (instance method)">#<strong>member!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#status-instance_method" title="#status (instance method)">#<strong>status</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop_subscription!-instance_method" title="#stop_subscription! (instance method)">#<strong>stop_subscription!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sum_donations-instance_method" title="#sum_donations (instance method)">#<strong>sum_donations</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#supervising%3F-instance_method" title="#supervising? (instance method)">#<strong>supervising?</strong>(id)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#trial_done%3F-instance_method" title="#trial_done? (instance method)">#<strong>trial_done?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Modules/ModulePayment.html" title="Modules::ModulePayment (module)">Modules::ModulePayment</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Modules/ModulePayment.html#change_connected_account-instance_method" title="Modules::ModulePayment#change_connected_account (method)">#change_connected_account</a></span>, <span class='object_link'><a href="Modules/ModulePayment.html#create_or_update_payment-instance_method" title="Modules::ModulePayment#create_or_update_payment (method)">#create_or_update_payment</a></span>, <span class='object_link'><a href="Modules/ModulePayment.html#manage_error-instance_method" title="Modules::ModulePayment#manage_error (method)">#manage_error</a></span>, <span class='object_link'><a href="Modules/ModulePayment.html#set_debited_funds-instance_method" title="Modules::ModulePayment#set_debited_funds (method)">#set_debited_funds</a></span>, <span class='object_link'><a href="Modules/ModulePayment.html#set_donation-instance_method" title="Modules::ModulePayment#set_donation (method)">#set_donation</a></span>, <span class='object_link'><a href="Modules/ModulePayment.html#set_fees-instance_method" title="Modules::ModulePayment#set_fees (method)">#set_fees</a></span>, <span class='object_link'><a href="Modules/ModulePayment.html#set_percent_cause-instance_method" title="Modules::ModulePayment#set_percent_cause (method)">#set_percent_cause</a></span>, <span class='object_link'><a href="Modules/ModulePayment.html#set_plan_id-instance_method" title="Modules::ModulePayment#set_plan_id (method)">#set_plan_id</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Modules/ModuleSlack.html" title="Modules::ModuleSlack (module)">Modules::ModuleSlack</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Modules/ModuleSlack.html#send_message_to_slack-instance_method" title="Modules::ModuleSlack#send_message_to_slack (method)">#send_message_to_slack</a></span></p>

  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="find_for_facebook_oauth-class_method">
  
    .<strong>find_for_facebook_oauth</strong>(access_token, signed_in_resourse = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 173</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_for_facebook_oauth'>find_for_facebook_oauth</span><span class='lparen'>(</span><span class='id identifier rubyid_access_token'>access_token</span><span class='comma'>,</span> <span class='id identifier rubyid_signed_in_resourse'>signed_in_resourse</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span>
  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:provider</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='comma'>,</span> <span class='symbol'>:uid</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_user'>user</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_registred_user'>registred_user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:email</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_registred_user'>registred_user</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_registred_user'>registred_user</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span> <span class='op'>!=</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span> <span class='op'>||</span> <span class='id identifier rubyid_registred_user'>registred_user</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>!=</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>||</span> <span class='id identifier rubyid_registred_user'>registred_user</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span> <span class='op'>!=</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_credentials'>credentials</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span>
        <span class='id identifier rubyid_registred_user'>registred_user</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span> <span class='op'>=</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span>
        <span class='id identifier rubyid_registred_user'>registred_user</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span> <span class='op'>=</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span>
        <span class='id identifier rubyid_registred_user'>registred_user</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_credentials'>credentials</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span>
        <span class='id identifier rubyid_registred_user'>registred_user</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='kw'>end</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_registred_user'>registred_user</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
        <span class='label'>name:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_raw_info'>raw_info</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>||</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='comma'>,</span>
        <span class='label'>first_name:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_raw_info'>raw_info</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span><span class='comma'>,</span>
        <span class='label'>last_name:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_raw_info'>raw_info</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span><span class='comma'>,</span>
        <span class='label'>city:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_raw_info'>raw_info</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>?</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_extra'>extra</span><span class='period'>.</span><span class='id identifier rubyid_raw_info'>raw_info</span><span class='period'>.</span><span class='id identifier rubyid_location'>location</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='op'>:</span> <span class='kw'>nil</span><span class='comma'>,</span>
        <span class='label'>provider:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='comma'>,</span>
        <span class='label'>email:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='comma'>,</span>
        <span class='label'>uid:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span>
        <span class='label'>token:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_credentials'>credentials</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span>
        <span class='label'>picture:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_image'>image</span><span class='comma'>,</span>
        <span class='label'>password:</span> <span class='const'>Devise</span><span class='period'>.</span><span class='id identifier rubyid_friendly_token'>friendly_token</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>20</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_for_google_oauth2-class_method">
  
    .<strong>find_for_google_oauth2</strong>(access_token, signed_in_resourse = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 148</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_for_google_oauth2'>find_for_google_oauth2</span><span class='lparen'>(</span><span class='id identifier rubyid_access_token'>access_token</span><span class='comma'>,</span> <span class='id identifier rubyid_signed_in_resourse'>signed_in_resourse</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span>
  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:provider</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='comma'>,</span> <span class='symbol'>:uid</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_user'>user</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_registred_user'>registred_user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:email</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_registred_user'>registred_user</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_registred_user'>registred_user</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
        <span class='label'>name:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='label'>first_name:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>first_name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='label'>last_name:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>last_name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='label'>provider:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='comma'>,</span>
        <span class='label'>email:</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='label'>uid:</span> <span class='id identifier rubyid_access_token'>access_token</span><span class='period'>.</span><span class='id identifier rubyid_uid'>uid</span><span class='comma'>,</span>
        <span class='label'>picture:</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_image'>image</span><span class='comma'>,</span>
        <span class='label'>password:</span> <span class='const'>Devise</span><span class='period'>.</span><span class='id identifier rubyid_friendly_token'>friendly_token</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>20</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_uri-class_method">
  
    .<strong>process_uri</strong>(uri)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


205
206
207
208
209
210
211</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 205</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_process_uri'>process_uri</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>open-uri</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>open_uri_redirections</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_uri'>uri</span><span class='comma'>,</span> <span class='symbol'>:allow_redirections</span> <span class='op'>=&gt;</span> <span class='symbol'>:safe</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
    <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_base_uri'>base_uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="collection_supervising-instance_method">
  
    #<strong>collection_supervising</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


213
214
215</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 213</span>

<span class='kw'>def</span> <span class='id identifier rubyid_collection_supervising'>collection_supervising</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_users'>users</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_event_last_ecosystem_seen-instance_method">
  
    #<strong>create_event_last_ecosystem_seen</strong>(ecosystem_now)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 319</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_event_last_ecosystem_seen'>create_event_last_ecosystem_seen</span><span class='lparen'>(</span><span class='id identifier rubyid_ecosystem_now'>ecosystem_now</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>last_ecosystem_seen:</span> <span class='id identifier rubyid_ecosystem_now'>ecosystem_now</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_intercom'>intercom</span> <span class='op'>=</span> <span class='const'>Intercom</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>app_id:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INTERCOM_API_ID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>api_key:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INTERCOM_API_KEY</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_intercom'>intercom</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
      <span class='label'>event_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>last_ecosystem_seen</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>created_at:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span>
      <span class='label'>user_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>email:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='comma'>,</span>
      <span class='label'>metadata:</span> <span class='lbrace'>{</span>
        <span class='label'>ecosystem:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_last_ecosystem_seen'>last_ecosystem_seen</span>
      <span class='rbrace'>}</span>
    <span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Intercom</span><span class='op'>::</span><span class='const'>IntercomError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_event_no_business-instance_method">
  
    #<strong>create_event_no_business</strong>(lat_lng)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 300</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_event_no_business'>create_event_no_business</span><span class='lparen'>(</span><span class='id identifier rubyid_lat_lng'>lat_lng</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_coordinates'>coordinates</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_lat_lng'>lat_lng</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='comma'>,</span> <span class='id identifier rubyid_lat_lng'>lat_lng</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>,</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_city'>city</span> <span class='op'>=</span> <span class='const'>Geocoder</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='id identifier rubyid_coordinates'>coordinates</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:city</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_intercom'>intercom</span> <span class='op'>=</span> <span class='const'>Intercom</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>app_id:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INTERCOM_API_ID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>api_key:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INTERCOM_API_KEY</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_intercom'>intercom</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
      <span class='label'>event_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no_business_around</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>created_at:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span>
      <span class='label'>user_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>email:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='comma'>,</span>
      <span class='label'>metadata:</span> <span class='lbrace'>{</span>
        <span class='label'>city:</span> <span class='id identifier rubyid_city'>city</span>
      <span class='rbrace'>}</span>
    <span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Intercom</span><span class='op'>::</span><span class='const'>IntercomError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_name_or_email-instance_method">
  
    #<strong>find_name_or_email</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>def should_payin?</p>

<pre class="code ruby"><code class="ruby"><span class='lparen'>(</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_code_partner'>code_partner</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span> <span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subscription'>subscription</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>M</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_last_payment'>date_last_payment</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>||</span> <span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_last_payment'>date_last_payment</span> <span class='op'>&lt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span> <span class='rparen'>)</span> <span class='rparen'>)</span> <span class='rparen'>)</span> <span class='op'>||</span>
<span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subscription'>subscription</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Y</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span> <span class='op'>!</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_last_payment'>date_last_payment</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>||</span> <span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_last_payment'>date_last_payment</span> <span class='op'>&lt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='int'>12</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span> <span class='rparen'>)</span> <span class='rparen'>)</span> <span class='rparen'>)</span> <span class='rparen'>)</span> <span class='op'>||</span>
<span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_code_partner'>code_partner</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_end_partner'>date_end_partner</span> <span class='op'>&lt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
</code></pre>

<p>end</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


234
235
236</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 234</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_name_or_email'>find_name_or_email</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span> <span class='op'>||</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>||</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="member!-instance_method">
  
    #<strong>member!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 238</span>

<span class='kw'>def</span> <span class='id identifier rubyid_member!'>member!</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_member'>member</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_stop_subscription'>date_stop_subscription</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="status-instance_method">
  
    #<strong>status</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224
225
226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 222</span>

<span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Inscrit depuis </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_l'>l</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span><span class='comma'>,</span> <span class='label'>format:</span> <span class='symbol'>:long</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_member'>member</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A l&#39;essai jusqu&#39;au </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_l'>l</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_end_partner'>date_end_partner</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span><span class='comma'>,</span> <span class='label'>format:</span> <span class='symbol'>:long</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_code_partner'>code_partner</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Abonné depuis le </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_l'>l</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_subscription'>date_subscription</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span><span class='comma'>,</span> <span class='label'>format:</span> <span class='symbol'>:long</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop_subscription!-instance_method">
  
    #<strong>stop_subscription!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 253</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop_subscription!'>stop_subscription!</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_member'>member</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_stop_subscription'>date_stop_subscription</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='id identifier rubyid_subscription_save'>subscription_save</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subscription'>subscription</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subscription'>subscription</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_amount_save'>amount_save</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_amount'>amount</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_amount'>amount</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_last_payment'>date_last_payment</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_code_partner_save'>code_partner_save</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_code_partner'>code_partner</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_code_partner'>code_partner</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_business_supervisor_id'>business_supervisor_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_date_end_partner'>date_end_partner</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='comment'># Delete Subscription on stripe
</span>  <span class='id identifier rubyid_subscription'>subscription</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="StripeServices.html" title="StripeServices (class)">StripeServices</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="StripeServices.html#initialize-instance_method" title="StripeServices#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>user:</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_delete_subscription'><span class='object_link'><a href="StripeServices.html#delete_subscription-instance_method" title="StripeServices#delete_subscription (method)">delete_subscription</a></span></span> <span class='kw'>if</span> <span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_subscription_id'>subscription_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_plan_id'>plan_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
  <span class='comment'># SEND EVENT TO INTERCOM
</span>  <span class='id identifier rubyid_intercom'>intercom</span> <span class='op'>=</span> <span class='const'>Intercom</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>app_id:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INTERCOM_API_ID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>api_key:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>INTERCOM_API_KEY</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_intercom'>intercom</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
      <span class='label'>event_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stop-subscription</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='label'>created_at:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span>
      <span class='label'>user_id:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
      <span class='label'>email:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span>
    <span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Intercom</span><span class='op'>::</span><span class='const'>IntercomError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>end</span>

  <span class='comment'>#SEND EVENT TO SLACK
</span>  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span>  <span class='id identifier rubyid_find_name_or_email'>find_name_or_email</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_code_partner_save'>code_partner_save</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> a résilié sa période d&#39;essai.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> a résilié son abonnement</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>+=</span> <span class='id identifier rubyid_subscription_save'>subscription_save</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>M</span><span class='tstring_end'>&quot;</span></span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> mensuel</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> annuel</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> de </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_amount_save'>amount_save</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>€.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_message'>message</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> |</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>|</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_send_message_to_slack'>send_message_to_slack</span><span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SLACK_WEBHOOK_USER_URL</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sum_donations-instance_method">
  
    #<strong>sum_donations</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


296
297
298</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 296</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sum_donations'>sum_donations</span>
  <span class='id identifier rubyid_payments'>payments</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span><span class='lparen'>(</span><span class='symbol'>:donation</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="supervising?-instance_method">
  
    #<strong>supervising?</strong>(id)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


217
218
219
220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 217</span>

<span class='kw'>def</span> <span class='id identifier rubyid_supervising?'>supervising?</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='const'><span class='object_link'><a href="" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_manager'>manager</span> <span class='op'>==</span> <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="trial_done?-instance_method">
  
    #<strong>trial_done?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


244
245
246
247
248
249
250
251</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/user.rb', line 244</span>

<span class='kw'>def</span> <span class='id identifier rubyid_trial_done?'>trial_done?</span>
  <span class='comment'>#trial_done is true after the popud is display
</span>  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_code_partner'>code_partner</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_trial_done'>trial_done</span> <span class='op'>==</span> <span class='kw'>false</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_trial_done'>trial_done</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Oct 30 21:57:27 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.9 (ruby-2.3.1).
</div>

    </div>
  </body>
</html>
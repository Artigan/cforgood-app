<script>

  var geoJson = <%= raw(@geojson.to_json) %>;

  var coordinates = geoJson.features[0].geometry.coordinates;

  mapboxgl.accessToken = 'pk.eyJ1IjoiZnJlZHBldHJpcyIsImEiOiJjaWtoem9qd2IwMDJmdnBtNmZ0Y29zcG5sIn0.atyCUDfyMaoUauNY1diwtQ';
  var map = new mapboxgl.Map({
    container: 'map-perk',
    style: 'mapbox://styles/fredpetris/cikporvjj00p8b5lwovwd3kq9',
    center: coordinates,
    interactive: false,
    zoom: 15
  });

  map.on('style.load', function () {
    map.addSource("markers", {
      "type": "geojson",
      "data": geoJson
    });

    map.addLayer({
      "id": "markers",
      "type": "symbol",
      "source": "markers",
      "interactive": true,
      "layout": {
        "icon-image": "{marker-symbol}",
        "icon-offset": [5,-20]
      }
    });
  });

  if (<%= device_type == :mobile %>) {
    map.flyTo({center: [coordinates[0]+0.002,coordinates[1]+0.0005]});
  } else {
    map.flyTo({center: [coordinates[0]+0.005,coordinates[1]]});
  }

</script>


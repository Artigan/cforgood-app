<div class="code-perk-offline">
    <!-- ITINERAIRE -->
  <div class="offline-itineraire">
    <p class="offline-itineraire-legend"> Pour rejoindre votre commerce :</p>
    <%= link_to "Indiquez Moi L'itinéraire", "http://maps.google.com/maps", class: "button button-turquoise", id:"link-map", disabled: true, data: { locale: I18n.locale, destination: { latitude: Perk.find(params[:perk_id]).business.latitude, longitude: Perk.find(params[:perk_id]).business.longitude } }, :target => "_blank" %>
  </div>
  <!-- INPUT CODE PERK -->
  <div class="offline-code">
    <p class="offline-code-legend">Pour profiter du Bon Plan et accédez à votre carte membre, renseignez le code :</p>
    <%= simple_form_for :code, url: perk_uses_path(params[:perk_id], current_user), remote: true, authenticity_token: true, html: { id: :create_use } do |f| %>
      <%= f.input :perk_code, placeholder: "Saisissez le code", label: false, input_html: { :size => 5, :maxlength => 5, id: :perk_code }  %>
      <%= f.submit "Validez", class: "button button-turquoise validation" %>
    <% end %>
    <p id="error-modal"></p>
  </div>
</div>

<% content_for :after_js do %>

  <script type="text/javascript">setRoutePathFromLocation()</script>

  <script>
    // CONTROL CODE PERK
    $(document).ready(function() {
      $(".validation").on('click', function(e) {
        e.preventDefault();
        if ("<=% @business.perks.find(params[:perk_id]).perk_usable?(current_user) %>" == false) {
          $("#error-modal").html("");
          $("#error-modal").append("Ce bon plan n'est plus disponible");
        } else if ("<%= Perk.find(params[:perk_id]).perk_code %>" != $("#perk_code").val().toUpperCase()) {
            $("#error-modal").html("");
            $("#error-modal").append("Le code est erroné");
        } else {
            $("#create_use").submit();
        };
      });
    });
  </script>

<% end %>

<div class="dashboard-create-perk">
  <div class="mobile-menu-overlay hidden"></div>
  <%= image_tag('logopouce.png', class: 'logo-title') %>
  <span class="view-title">Créer un bon plan</span>

  <!-- CARDS PERK -->
  <%= render "pro/perks/form/cards_perk" %>

  <!-- Card INSPIRATION -->
<!--   <div class="type-card" id="perk-inspiration">
    <div class="type-title">
      <span>En manque d'inspiration !</span>
      <span class="type-category">Quelques exemples...</span>
    </div>
    <div class="type-inspiration">
      <ul>
        <li id="perk-example-appel"><a><i class="fa fa-gift"></i></a></li>
        <li id="perk-example-durable"><a><i class="fa fa-repeat"></i></a></li>
        <li id="perk-example-flash"><a><i class="fa fa-bolt"></i></a></li>
      </ul>
    </div>
  </div> -->

  <!-- FORMS PERK -->
  <%= render "pro/perks/form/forms_perk", action: 'create', submit_label: 'Créer votre bon plan'%>


  <!-- Exemple Perk APPEL -->
<!--   <div class="perk-example-appel perk-form-card">
    <div class="perk-form-title">
      <i class="fa fa-times close-create"></i>
      <span>Idées de Bons plans de bienvenue</span>
      <span class="type-category">Aquisition</span>
    </div>
    <div class="type-example">
      <ul>
        <li><%#= image_tag "exemple-perk-appel-naturome.png"%></li>
        <li><%#= image_tag "exemple-perk-appel-wan.png"%></li>
      </ul>
    </div>
  </div> -->

  <!-- Exemple Perk DURABLE -->
<!--   <div class="perk-example-durable perk-form-card">
    <div class="perk-form-title">
      <i class="fa fa-times close-create"></i>
      <span>Idées de Bons plans flash</span>
      <span class="type-category">Fidélisation</span>
    </div>
    <div class="type-example">
      <ul>
        <li><%#= image_tag "exemple-perk-appel-naturome.png"%></li>
        <li><%#= image_tag "exemple-perk-appel-wan.png"%></li>
      </ul>
    </div>
  </div> -->

  <!-- Exemple Perk FLASH -->
 <!--  <div class="perk-example-flash perk-form-card">
    <div class="perk-form-title">
      <i class="fa fa-times close-create"></i>
      <span>Idées de Bons plans flash</span>
      <span class="type-category">Activation</span>
    </div>
    <div class="type-example">
      <ul>
        <li><%#= image_tag "exemple-perk-appel-naturome.png"%></li>
        <li><%#= image_tag "exemple-perk-appel-wan.png"%></li>
      </ul>
    </div>
  </div> -->

</div>

<!-- CREATE PERK CONFIRMATION -->
<%= render "pro/perks/form/done" %>

<% content_for :after_js do %>

  <script>

    $(document).ready(function() {

      // PERK FLASH - INCREMENT QUANTITY
      $("#quantity-plus").on("click", function(e) {
        e.preventDefault();
        fieldId = $('#perk_times');
        var currentVal = parseInt($(fieldId).val());
        if (!isNaN(currentVal)) {
          $(fieldId).val((currentVal + 1).toString());
        } else {
          $(fieldId).val('1');
        }
      });

      // PERK FLASH - DECREASE QUANTITY
      $("#quantity-minus").on("click", function(e) {
        e.preventDefault();
        fieldId = $('#perk_times');
        var currentVal = parseInt($(fieldId).val());
        if (!isNaN(currentVal) && currentVal > 0) {
          $(fieldId).val(currentVal - 1);
        } else {
          $(fieldId).val(0);
        }
      });

      // OPEN PERK ON CLICK
      $(".type-card").on("click", function() {
        var perkType = $(this).attr('id');
        $(this).find('.fa-plus').addClass('plus-animation');
        $('.dashboard-create-perk').scrollTop(0);
        $(".dashboard-overlay").removeClass('hidden');
        $("."+perkType).addClass('type-show');
        $(this).addClass('card-visible').siblings('.type-card').addClass('card-invisible');
      });

      // OPEN PERK EXAMPLE ON CLICK
      $(".type-inspiration li").on("click", function() {
        var perkExample = $(this).attr('id');
        $('.dashboard-create-perk').scrollTop(0);
        $(".dashboard-overlay").removeClass('hidden');
        $("."+perkExample).addClass('type-show');
        $(this).parents('.type-card').addClass('card-visible').siblings('.type-card').addClass('card-invisible');
      });

      // CLOSE PERK ON CLICK
      $(".close-create").on("click", function(e) {
        e.preventDefault;
        $('.fa-plus').removeClass('plus-animation');
        $(".dashboard-overlay").addClass('hidden');
        $(".perk-form-card").removeClass('type-show');
        $('.type-card').removeClass('card-invisible');
      });

      // REMOVE PERK ON CLICK OUTSIDE THE CARD
      $(".dashboard-overlay").on("click", function(e) {
        e.preventDefault;
        $(this).addClass('hidden');
        $(".perk-form-card").removeClass('type-show');
      });

      // SUPPLY BOOLEAN FIELDS
      $(".type-card").on("click", function(e) {
        e.preventDefault;
        var typePerk = $(this).val('div').attr('id');

        if (typePerk == "perk-appel") {
          $(".perk-appel #perk_appel").val("true");
          $(".perk-appel #perk_durable").val("false");
          $(".perk-appel #perk_flash").val("false");
        }
        if (typePerk == "perk-durable") {
          $(".perk-durable #perk_appel").val("false");
          $(".perk-durable #perk_durable").val("true");
          $(".perk-durable #perk_flash").val("false");
        }
        if (typePerk == "perk-flash") {
          $(".perk-flash #perk_appel").val("false");
          $(".perk-flash #perk_durable").val("false");
          $(".perk-flash #perk_flash").val("true");
        }
      });

      // PICTURE LOAD PREVIEW
      function readURL(file, classe) {
        var reader = new FileReader();
          reader.onload = function (e) {
            if ($("#"+classe).attr('src') === undefined) {
              $(".picture-container."+classe+" svg").remove();
              $(".picture-container."+classe).append('<img src=" " class="picture-perk-preview" id="'+classe+'">')
            };
            $("#"+classe).attr('src', e.target.result);
          }
        reader.readAsDataURL(file);
      }

      $("#perk_appel_file").on("change", function(e) {
        e.preventDefault();
        var newFile = document.querySelector('#perk_appel_file').files[0];
        $("#perk_appel_file").parent().children().html(newFile.name);
        readURL(newFile, "perk-appel-preview");
      });
      $("#perk_durable_file").on("change", function(e) {
        e.preventDefault();
        var newFile = document.querySelector('#perk_durable_file').files[0];
        $("#perk_durable_file").parent().children().html(newFile.name);
        readURL(newFile, "perk-durable-preview");
      });
      $("#perk_flash_file").on("change", function(e) {
        e.preventDefault();
        var newFile = document.querySelector('#perk_flash_file').files[0];
        $("#perk_flash_file").parent().children().html(newFile.name);
        readURL(newFile, "perk-flash-preview");
      });
    });

  </script>

<% end %>

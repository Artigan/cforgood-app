<!-- FORM SELECT CAUSE -->
<div class="choose-cause">
  <!-- USER SUPPORT -->
  <span class="tab-subtitle">Votre engagement</span>
  <div class="user-support">
    <div class="pictures-container">
      <div class="picture-container">
        <% if current_user.picture? %>
          <%= image_tag current_user.picture.url(:thumb), class: 'user-picture' %>
        <% else %>
          <div class="picture-none">
            <%= render 'shared/icons/profile' %>
          </div>
        <% end %>
      </div>
      <div class="picture-container">
        <% if current_user.cause_id.present? %>
          <%= image_tag Cause.find(current_user.cause_id).logo.url(:thumb), class: 'cause-picture' %>
        <% else %>
          <div class="picture-none">
            <%= render 'shared/icons/profile' %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="user-cause-disclaimer">
      <% if current_user.cause_id.present? %>
        Vous soutenez actuellement<br><i><%= Cause.find(current_user.cause_id).name %></i>.
      <% else %>
        Choisissez une association à soutenir !
      <% end %>
    </div>
  </div>
   <!-- CAUSES CARROUSEL -->
  <span class="tab-subtitle">Découvrir d'autres causes</span>
  <div class="causes-carrousel">
    <!-- Random Causes cards -->
    <% Cause.all.each do |cause| %>
      <%= link_to member_update_cause_path(cause_id: cause.id), method: :put, remote: true, authenticity_token: true do %>
        <!-- COMPONENT | CARD CAUSE -->
        <div class="card-cause" style="background-image: url('<%= image_url cause.picture %>');">
          <div class="disque-item item-category" style="background-color: <%= CauseCategory.find(cause.cause_category_id).color %>;">
            <%= image_tag image_url CauseCategory.find(cause.cause_category_id).picture %>
          </div>
          <span><%= cause.name %></span>
          <p><%= truncate(cause.description, length: 190) %></p>
          <div class="disque-item item-logo">
            <%= image_tag cause.logo %>
          </div>
        </div>
        <!-- END | CARD CAUSE -->
      <% end %>
    <% end %>
  </div>
</div>

<%= render 'components/popups/cause_validation' %>

<% content_for :after_js do %>
  <script>
    $(document).ready(function() {
      $(".cause-card").on("click", function(e) {
        e.preventDefault;
        var causeId = $(this).val('div').attr('id');
        $(".cause-overlay").toggleClass("cause-overlay");
        $($(this).toggleClass("cause-overlay"));
        $("select").val(causeId);
      });

      $(".cause-popover").popover({
        html: true,
        container: "body",
        trigger: "hover"
      });
    });
  </script>
<% end %>

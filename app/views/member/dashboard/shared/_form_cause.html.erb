<!-- FORM SELECT CAUSE -->
<div class="choose-cause">
  <div class="user-cause">
  <!-- USER SUPPORT -->
  <span class="tab-subtitle">Votre engagement</span>
    <div class="user-support">
      <div class="user-cause-container" style="background-image: url('<%= image_url Cause.find(current_user.cause_id).picture %>');">

        <div class="user-cause-content">
          <div class="pictures-container">
            <div class="picture-container">
              <% if current_user.picture? %>
                <%= image_tag current_user.picture.url(:thumb), class: 'user-picture' %>
              <% else %>
                <div class="picture-none">
                  <%= render 'shared/icons/profile' %>
                </div>
              <% end %>
            </div>
            <div class="picture-container">
              <% if current_user.cause_id.present? %>
                <%= image_tag Cause.find(current_user.cause_id).logo.url(:thumb), class: 'cause-picture' %>
              <% else %>
                <div class="picture-none">
                  <%= render 'shared/icons/profile' %>
                </div>
              <% end %>
            </div>
          </div>
          <div class="user-cause-disclaimer">
            <% if current_user.cause_id.present? %>
              Vous soutenez actuellement<br><i><%= Cause.find(current_user.cause_id).name %></i>.
            <% else %>
              Choisissez une association à soutenir !
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CAUSES CARROUSEL -->
  <div class="change-cause">
    <span class="tab-subtitle">Découvrir d'autres causes</span>
    <div class="causes-carrousel">
      <!-- Random Causes cards -->
      <% Cause.all.each do |cause| %>
        <% if cause.id != current_user.cause_id %>
          <!-- COMPONENT | CARD CAUSE -->
          <div id="#{cause.cause_category_id}" class="cause-presentation">
            <%= link_to asso_cause_path(cause), class: "card-frame" do %>
              <div class="card-cause" style="background-image: url('<%= image_url cause.picture %>');">
                <div class="disque-item item-category" style="background-color: <%= CauseCategory.find(cause.cause_category_id).color %>;">
                  <%= image_tag image_url CauseCategory.find(cause.cause_category_id).picture %>
                </div>
                <span><%= cause.name %></span>
                <p><%= truncate(cause.description, length: 190) %></p>
                <div class="disque-item item-logo">
                  <%= image_tag cause.logo %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
    <button class="user-button">Soutenir cette cause</button>
  </div>
</div>

<%= render 'components/popups/cause_validation' %>


<% content_for :after_js do %>
  <script>
    $(document).ready(function() {
      $(".user-button").on("click", function(e) {
        e.preventDefault;
        var causeId = $(this).val('div').attr('id');
        $(".popup-overlay").toggleClass("hidden");
        <% params[:cause_id] %> = causeId;
      });
    });
  </script>
<% end %>

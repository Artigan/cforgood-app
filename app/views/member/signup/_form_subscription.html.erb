<div class="signup-plan">
  <span>Choisissez votre abonnement</span>
  <div class="container-fluid">
    <div class="offer-index">
      <div class="offer-card offer-monthly">
        <div class="offer-title">Mensuel</div>
        <div class="offer-extra">Sans engagement de durée</div>
        <!-- RANGE SLIDER FOR PRICE -->
        <div class="offer-price">
          <label for="range">Choisissez le montant de votre souscription !</label>
          <input type="range" name="range" id="range" min="1" max="50" value="5"/>
          <output for="range" class="output">5</output>
          <p>La somme reversée à l'association de votre choix sera de
            <output class="output-asso">2,5</output>
          </p>
        </div>
        <!-- PARTNER CODE -->
        <div class="code-partner">
          <label for="code_partner" class="control-label">Code partenaire</label>
          <input type="text" name="code_partner" id="code_partner" class="form-control">
        </div>
        <div class="offer-btn">
          <%= simple_form_for(current_user, url: member_update_profile_path, method: :put, remote: true, authenticity_token: true, html: { id: "update_subscription" } ) do |f| %>
            <%= f.input :subscription, as: :hidden %>
            <%= f.input :amount, as: :hidden %>
            <%= f.input :code_partner, as: :hidden %>
            <%= f.submit "Souscrivez", class: "btn-subscription"%>
          <% end %>
        </div>
      </div>
      <div class="offer-card">
        <div class="offer-title">Entreprise</div>
        <div class="offer-extra">Pour vos clients ou salariés</div>
        <div class="offer-price">Nous consulter</div>
        <div class="offer-btn">
          <%= link_to "Contactez-nous", new_contact_form_path, class: "btn btn-bluenight" %>
        </div>
      </div>
    </div>
  </div>

  <%= link_to "Je souscris plus tard !", member_user_dashboard_path(current_user), class: "btn btn-no-subscription btn-turquoise" %>
  <button class="btn-plan">Suivant</button>
</div>

<% content_for :after_js do %>

  <script>
    $(document).ready(function() {
      function amountAsso(amount) {
        if (amount <= 5) {
          var pourcent = ((50 - 30)*((amount-1)/(5-1)))+30;
        } else if (amount <= 10) {
          var pourcent = ((70 - 50)*((amount-5)/(10-5)))+50;
        } else if (amount <= 15) {
          var pourcent = ((75 - 70)*((amount-10)/(15-10)))+70;
        } else if (amount <= 20) {
          var pourcent = ((77.5 - 75)*((amount-15)/(20-15)))+75;
        } else if (amount <= 25) {
          var pourcent = ((80 - 77.5)*((amount-20)/(25-20)))+77.5;
        } else if (amount <= 50) {
          var pourcent = ((85 - 80)*((amount-25)/(50-25)))+80;
        }
        var amountAsso = (amount * pourcent/100).toFixed(2) ;
        $('.output-asso').html(amountAsso);
      }


      $('#range').on('input', function() {
        $('.output').html(this.value);
        amountAsso(this.value);
      });

      $(".btn-subscription").on("click", function() {
        $("#user_subscription").val("M");
        $("#user_amount").val(parseInt($(".output").val()));
        $("#user_code_partner").val($('#code_partner').val());
      });

      $(".btn-plan").on("click", function(e) {
        e.preventDefault;
        $(".signup-plan").addClass("ishidden");
        $(".signup-payment").addClass("slideup");
        $("#signup-breadcrumb").addClass("slide-3");
      });

    });
  </script>

<% end %>

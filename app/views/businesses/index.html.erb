<%= content_for(:title) do %>
  Bons Plans
<% end %>
<%= content_for(:description) do %>
  Découvrez notre liste de bons plans
<% end %>

<div class="container-fluid admin">
  <!-- Sub Menu Sidebar -->
  <%= render "member/dashboard/shared/sidebar" %>
  <!-- Content - Statistics -->
  <div class="dashboard dashboard-view-perks">
    <div class="mobile-menu-overlay hidden"></div>
    <div class="side-menu-overlay hidden"></div>

    <div class="side-menu side-categories">
      <span id="open-categories"><i class="fa fa-cog"></i>Filtrer par catégories</span>
      <ul>
        <!-- <a href="#" data-filter="" class="filter-btn current">
          <li id="" class="category-item is-selected">
            <div class="container-icon" style="background-color: #DFDFDF;">
            </div>
            Voir les e-commerces
          </li>
        </a> -->
        <a href="#" data-filter="all" class="filter-btn current">
          <li id="categories-all" class="category-item is-selected">
            <div class="container-icon" style="background-color: #DFDFDF;">
            </div>
            Toutes les catégories
          </li>
        </a>
        <% BusinessCategory.all.each do |category| %>
        <a href="#" data-filter="<%= "."+category.id.to_s %>" class="filter-btn current">
          <li class="category-item">
            <div class="container-icon" style="background-color: <%= category.color %>;">
              <!-- <#= image_tag image_url category.picture %> -->
            </div>
            <%= category.name %>
          </li>
        </a>
        <% end %>
      </ul>
    </div>

    <div id="mixitup" class="container-perk-cards">
      <% @businesses.each do |business| %>
        <% business.perks.active.each do |perk| %>
          <!-- COMPONENT | CARD BON PLAN -->
          <%= link_to business_path(business, perk_id: perk.id), class: "card-frame mix #{business.business_category_id}" do %>
            <!-- CARD HEADER -->
            <div class="card-header">
              <div class="card-header-main">
                <span class="perk-title"><%= business.name %></span>
                <span class="perk-owner"><%= business.leader_first_name %> <%= business.leader_last_name %> vous accueillera</span>
              </div>
              <div class="card-header-category" style="background-color: <%= BusinessCategory.find(business.business_category_id).color %>;">
                <%= image_tag image_url BusinessCategory.find(business.business_category_id).picture %>
                <!-- <div class="category-container" style="background-color: <#= BusinessCategory.find(business.business_category_id).color %>;">
                </div> -->
              </div>
            </div>
            <!-- CARD BODY -->
            <div class="card-body" style="background-image: url('<%= image_url business.picture %>');">
              <div class="business-details">
                <% if perk.flash? %>
                  <span style="background-color: <%= BusinessCategory.find(business.business_category_id).color %>;"><i class="fa fa-flash"></i><%= perk.times - Use.where(perk_id: perk.id).count  %> restants</span>
                <% end %>
                <h3><%= perk.perk %></h3>
              </div>
            </div>
          <% end %>
          <!-- END | CARD BON PLAN -->
        <% end %>
      <% end %>
    </div>

  <!-- END | DASHBOARD PERKS -->
  </div>
 <!-- END | ADMIN -->
</div>

<% content_for :after_js do %>
  <script>
    $(document).ready(function(){
      $('#mixitup').mixItUp({
        load:{
          filter: 'all'
        },
        animation: {
          duration: 300,
          effects: 'fade',
          easing: 'ease'
        },
        selectors: {
          filter: '.filter-btn'
        },
        controls: {
          enable: true
        }
      });

      $('.category-item').click(function(event) {
        if ($(this).val('div').attr('id') != 'categories-all'){
          $('.category-item').removeClass('is-selected'); // TO DELETE FOR MULTIPLE SELECTION
          $('#categories-all').removeClass('is-selected');
          $(this).toggleClass('is-selected');
        } else {
          $('.category-item').removeClass('is-selected');
          $('#categories-all').addClass('is-selected');
        }
      });

      $('#open-categories').click(function(event) {
        $('.side-menu-overlay').toggleClass('hidden');
        //$('.container-perk-cards').toggleClass('blurred');
        $('.side-categories').toggleClass('is-open-max');
        $('.category-item').toggleClass('is-open-min');
        $('.side-notification').removeClass('is-open-max');
        $('.notification-panel').removeClass('is-open-min');
      });
    });
  </script>
<% end %>
